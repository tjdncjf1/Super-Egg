<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Must</title>
  <style>
    img {
      width: 10%;
    }
  </style>
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
</head>
<body>

<script>
$(function(){
  $("#searchButton").click(function() {
  	  $('#search-items').show();
      var keyword = $("#searchValue").val();
      if(!keyword) {
          alert("검색어를 입력하세요.");
          return false;
      }
       
      var proxy_url = "http://openapi.naver.com/search?";
          proxy_url += "key=be6c30428660950b9ece4f651a0d2dba";
          proxy_url += "&target=shop";
          proxy_url += "&display=10";
          proxy_url += "&query="+ encodeURIComponent(keyword);
       
      $.ajax({
          url: "proxy.jsp",
          type: "get",
          data: {"url" : proxy_url},
          dataType: "xml",
          success: function(data){
                  console.log(data);
                  $('#search-items').empty();
                  $('#detail-items').empty();
              $(data).find("item").each(function(i){
                  var title = $(this).find("title").text();
                  var image = $(this).find("image").text();
                  var min_price = parseInt($(this).find("lprice").text());
                  var link = $(this).find("link").text();
                  var pId = $(this).find("productId").text();
                  
                  var output ='';
                  output += '<img src="' + image + '" class="select' + i + '"/>';
                  $(output).click(function(){
                  	
                    // detail 쪽 div에 아이템 상세정보 표시
                    // 서버에 아이템 등록
                    detail(title, image, min_price, link, pId); 
                    
                  }).appendTo('#search-items');
                  
              }); 
          }});
       return false;
  });
});

function detail(title, image, min_price, link, pId) {
  var ot = '';
  ot += '<img src="' + image + '"/>';
  ot += '<p><h2>' + title + '</h2></p>';
  ot += '<p><h3>최저가: ' + min_price + '</h3></p>';
  ot += '<h3>희망가격: <input type="number" id="wishPrice"><br></h3>';
  ot += '<p><h3>상품코드: ' + pId + '</h3></p>';
  ot += '<input type="button" value="등록" class="reg_button">';
  $(ot).appendTo('#detail-items');
  
  console.log(typeof min_price);
  console.log(typeof parseInt($('#wishPrice').val()));
  console.log(typeof new Date());
  
  $('#search-items').hide();
  $('#detail-items').show();
 
  $('.reg_button').click(function() {
  	confirm('등록하시겠습니까?');
    $.ajax({
      url : 'item/addItem.do',
      type : 'get',
      data : {
        title : title,
        image : image,
        min_price : min_price,
        wish_price : parseInt($('#wishPrice').val()),
        link : link,
        pId : pId,
        reg_date : new Date()
      }}).done(function(){
      	  $('#detail-items').hide();
      	  $('#list-items').show();
      }); 
  });
  
}

</script>
 <input type="search" id="searchValue">
 <input type="button" value="검색" id="searchButton">
 <div id="search-items" style="display: none;"></div>
 <div id="detail-items" style="display: none;"></div>
 <div id="list-items"   style="display: none;">으허허</div>
</body>
</html>


