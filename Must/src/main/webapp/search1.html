<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Must</title>
<link rel="stylesheet" type="text/css" href="css/accordion/demo.css" />
<link rel="stylesheet" type="text/css" href="css/accordion/style.css" />
<link rel="stylesheet" type="text/css" href="css/accordion/common.css" />
<link href='http://fonts.googleapis.com/css?family=Josefin+Slab:400,700' rel='stylesheet' type='text/css' />
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/accordion/jquery.accordion.js"></script>
<script type="text/javascript" src="js/accordion/jquery.easing.1.3.js"></script>
</head>
<body>

<script>
$(function(){
  $("#searchButton").click(function() {
  	  $('#search-items').show();
      var keyword = $("#searchValue").val();
      if(!keyword) {
          alert("검색어를 입력하세요.");
          return false;
      }
       
      var proxy_url = "http://openapi.naver.com/search?";
          proxy_url += "key=be6c30428660950b9ece4f651a0d2dba";
          proxy_url += "&target=shop";
          proxy_url += "&display=10";
          proxy_url += "&query="+ encodeURIComponent(keyword);
       
      $.ajax({
          url: "proxy.jsp",
          type: "get",
          data: {"url" : proxy_url},
          dataType: "xml",
          success: function(data){
                  console.log(data);
                  $('#search-items').empty();
                  $('#detail-items').empty();
              $(data).find("item").each(function(i){
                  var title = $(this).find("title").text();
                  var image = $(this).find("image").text();
                  var min_price = parseInt($(this).find("lprice").text());
                  var link = $(this).find("link").text();
                  var pId = $(this).find("productId").text();
                  
                  var output ='';
                  output += '<figure>';
                  output += '<img src="' + image + '"/><br>';
                  output += '<figcaption> '+ title + '</figcaption> ';
                  output += '</figure> ';
                  $(output).click(function(){
                  	
                    // detail 쪽 div에 아이템 상세정보 표시
                    // 서버에 아이템 등록
                    detail(title, image, min_price, link, pId); 
                    
                    // list-items div에 아코디언 출력
                    itemlist();
                    
                      
                    
                  }).appendTo('#search-items');
                  $('#st-accordion').accordion({
                    oneOpenedItem : true
                  });
              }); 
          }});
       return false;
  });
});

// 상세 정보
function detail(title, image, min_price, link, pId) {
  var ot = '';
  ot += '<img src="' + image + '"/>';
  ot += '<p><h2>' + title + '</h2></p>';
  ot += '<p><h3>최저가: ' + min_price + '</h3></p>';
  ot += '<h3>희망가격: <input type="number" id="wishPrice"><br></h3>';
  ot += '<p><h3>상품코드: ' + pId + '</h3></p>';
  ot += '<input type="button" value="등록" class="reg_button">';
  $(ot).appendTo('#detail-items');
  
  console.log(typeof min_price);
  console.log(typeof parseInt($('#wishPrice').val()));
  console.log(typeof new Date());
  
  $('#search-items').hide();
  $('#detail-items').show();
 
  $('.reg_button').click(function() {
  	confirm('등록하시겠습니까?');
    $.ajax({
      url : 'item/addItem.do',
      type : 'get',
      data : {
        title : title,
        image : image,
        min_price : min_price,
        wish_price : parseInt($('#wishPrice').val()),
        link : link,
        pId : pId,
        reg_date : new Date()
      },
      success : function(){
      	$('#detail-items').hide();
      	$('#list-items').show();
      },
      error : function() {
      	alert('시스템이 바쁩니다.\n나중에 다시 시도해 주세요!');
      }
    });  
  }); // 등록 버튼 클릭 괄호 
  
} // 디테일 괄호
/*
function itemlist() {
  $.ajax({
  	url: 'item/list.do',
  	type: 'get',
  	success: function(items){
  		console.log(items);
  		var item = null;
  		for (var i = 0; i < items.length; i++) {
  			item = items[i];
  		  var accor = '<div id="st-accordion" class="st-accordion">';
  		  accor += '<ul><li><a href="#">' + item.title + '<span class="st-arrow">Open or Close</span></a>';
  		  accor += '<div class="st-content">';	
  			accor += '<img src="' + item.image + '" alt="image01"/></div></li></ul></div>';
  		  accor += '<p>최저가: ' + item.min_price '</p>';
  		  accor += '<p>최저가: ' + item.wish_price '</p>'; 
  		  $(accor).appendTo('#list-items');
  		}
  		
  	  $('#st-accordion').accordion({
  	    oneOpenedItem : true
  	  });
  		
  	} // success 괄호
  });	// $.ajax 괄호
} // list 괄호 */
</script>
 <input type="search" id="searchValue">
 <input type="button" value="검색" id="searchButton">
 <hr>
 <div id="search-items" style="display: none;"></div>
 <div id="detail-items" style="display: none;"></div>
 <div id="list-items"   style="display: none;"></div>
</body>
</html>


